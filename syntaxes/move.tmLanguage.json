{
    "scopeName": "source.move",
    "repository": {

        "line-comments": {
            "comment": "Single-line comment",
            "name": "comment.line.double-slash.move",
            "begin": "//",
            "end": "$"
        },

        "block-comments": {
            "comment": "Supported since https://github.com/libra/libra/pull/3714",
            "patterns": [
                {
                    "comment": "Block documentation comment",
                    "name": "comment.block.documentation.move",
                    "begin": "/\\*[\\*!](?![\\*/])",
                    "end": "\\*/"
                },
                {
                    "comment": "Block comment",
                    "name": "comment.block.move",
                    "begin": "/\\*",
                    "end": "\\*/"
                }
            ]
        },

        "comments": {
            "patterns": [
                { "include": "#line-comments" },
                { "include": "#block-comments" }
            ]
        },

        "script": {
            "begin": "\\b(script)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.script.move" }
            },
            "end": "(?<=})",
            "patterns": [
                { "include": "#comments" },
                {
                    "comment": "Script scope",
                    "begin": "{",
                    "end": "}",
                    "patterns": [
                        { "include": "#comments" },
                        { "include": "#import" },
                        { "include": "#fun" }
                    ]
                }
            ]
        },

        "address": {
            "begin": "\\b(address)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.address.move" }
            },
            "end": "(?<=})",
            "patterns": [
                { "include": "#comments" },
                { "include": "#module" }
            ]
        },

        "module": {
            "comment": "Module definition",
            "begin": "\\b(module)\\b",
            "end": "(?<=})",
            "beginCaptures": {
                "1": { "name": "storage.modifier.type.move" }
            },
            "patterns": [
                { "include": "#comments" },
                {
                    "comment": "Module name",
                    "begin": "(?<=module)",
                    "end": "(?={)",
                    "name": "entity.name.type.move",
                    "patterns": [
                        { "include": "#comments" }
                    ]
                },
                {
                    "comment": "Module scope",
                    "begin": "{",
                    "end": "}",
                    "patterns": [
                        { "include": "#comments" },
                        { "include": "#import" },
                        { "include": "#resource" },
                        { "include": "#struct" },
                        { "include": "#public_fun" },
                        { "include": "#native_fun" },
                        { "include": "#fun" },
                        { "include": "#spec" },

                        { "include": "#block" }
                    ]
                }
            ]
        },

        "import": {
            "begin": "\\b(use)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.type.move" }
            },
            "end": ";",
            "patterns": [
                { "include": "#comments" }
            ]
        },

        "struct": {
            "begin": "\\b(struct)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.type.move" }
            },
            "end": "(?<=})",
            "patterns": [
                { "include": "#comments" },
                {
                    "comment": "Struct definition",
                    "begin": "(?<=struct)",
                    "end": "(?={)",
                    "patterns": [
                        { "include": "#comments" },
                        {
                            "comment": "Struct name",
                            "match": "\\b(\\w+)\\b",
                            "name": "entity.name.type.move"
                        },
                        {
                            "comment": "Generic",
                            "begin": "<",
                            "end": ">",
                            "patterns": [
                                { "include": "#comments" }
                            ]
                        }
                    ]
                },
                {
                    "comment": "Struct body",
                    "begin": "{",
                    "end": "}",
                    "patterns": [
                        { "include": "#comments" },
                        { "include": "#types" }
                    ]
                }
            ]
        },

        "resource": {
            "comment": "Resource definition",
            "begin": "\\b(resource)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.type.move" }
            },
            "end": "(?<=})",
            "patterns": [
                { "include": "#struct" }
            ]
        },

        "native_fun": {
            "comment": "Native function",
            "begin": "\\b(native)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.move" }
            },
            "end": "(?<=[;])",
            "patterns": [
                { "include": "#comments" },
                { "include": "#fun_signature" }
            ]
        },

        "public_fun": {
            "comment": "Public function",
            "begin": "\\b(public)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.move" }
            },
            "end": "(?<=})",
            "patterns": [
                { "include": "#comments" },
                { "include": "#fun" }
            ]
        },

        "fun": {
            "patterns": [
                { "include": "#fun_signature" },
                { "include": "#fun_body" }
            ]
        },

        "fun_signature": {
            "comment": "Function signature",
            "begin": "\\b(fun)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.fun.move" }
            },
            "end": "(?=[;{])",
            "patterns": [
                { "include": "#comments" },
                { "include": "#types" },
                {
                    "comment": "Function name",
                    "begin": "(?<=fun)",
                    "end": "(?=[<(])",
                    "patterns": [
                        { "include": "#comments" },
                        {
                            "name": "entity.name.function.move",
                            "match": "\\b(\\w+)\\b"
                        }
                    ]
                },
                {
                    "comment": "Generic < >",
                    "begin": "<",
                    "end": ">",
                    "patterns": [
                        { "include": "#comments" }
                    ]
                },
                {
                    "comment": "Parentheses",
                    "begin": "[(]",
                    "end": "[)]",
                    "patterns": [
                        { "include": "#comments" },
                        { "include": "#types" }
                    ]
                },
                {
                    "comment": "Keyword acquires",
                    "match": "\\b(acquires)\\b",
                    "name": "storage.modifier"
                }
            ]
        },

        "fun_body": {
            "comment": "Function body",
            "begin": "{",
            "end": "}",
            "patterns": [
                { "include": "#comments" },
                { "include": "#block" },

                { "include": "#let" }
            ]
        },

        "let": {
            "comment": "Keyword let",
            "begin": "\\b(let)\\b",
            "beginCaptures": {
                "1": { "name": "keyword.control.move" }
            },
            "end": ";",
            "patterns": [
                { "include": "#comments" }
            ]
        },

        "block": {
            "begin": "{",
            "end": "}",
            "name": "entity.name.function.call.move",
            "patterns": [
                { "include": "#block" }
            ]
        },

        "types": {
            "comment": "Built-in types + vector",
            "patterns": [
                { "include": "#primitives" },
                { "include": "#vector" }
            ]
        },

        "vector": {
            "begin": "\\b(vector)<",
            "beginCaptures": {
                "1": { "name": "support.type.vector.move" }
            },
            "end": ">",
            "patterns": [
                { "include": "#primitives" },
                { "include": "#vector" }
            ]
        },

        "primitives": {
            "comment": "Primitive types",
            "match": "\\b(u8|u64|u128|address|bool)\\b",
            "name": "support.type.primitives.move"
        },

        "spec": {
            "begin": "\\b(spec)\\b",
            "beginCaptures": {
                "1": { "name": "storage.modifier.spec.move" }
            },
            "end": "(?<=})",
            "patterns": [
                {
                    "comment": "Spec target",
                    "match": "\\b(module|schema|struct|fun)",
                    "name": "storage.modifier.spec.target.move"
                },
                {
                    "comment": "Spec block",
                    "begin": "{",
                    "end": "}",
                    "patterns": [
                        { "include": "#comments" },
                        { "include": "source.move.spec" }
                    ]
                }
            ]
        }
    },

    "patterns": [
        { "include": "#address" },
        { "include": "#module" },
        { "include": "#script" }
    ]
}
